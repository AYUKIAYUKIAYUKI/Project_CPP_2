//============================================================================
// 
// ブロック [block.cpp]
// Author : 福田歩希
// 
//============================================================================

//****************************************************
// インクルードファイル
//****************************************************
#include "block.h"

#include "renderer.h"

// オブジェクト用
#include "rubble.h"

// 判定可視化用
#include "render_collision.h"

//****************************************************
// usingディレクティブ
//****************************************************
using namespace abbr;

//============================================================================
// 
// publicメンバ
// 
//============================================================================

//============================================================================
// デフォルトコンストラクタ
//============================================================================
CBlock::CBlock() :
	CObject_X{ LAYER::MIDDLE }
{

}

//============================================================================
// デストラクタ
//============================================================================
CBlock::~CBlock()
{
#if 1
	for (int i = 0; i < 2; i++)
	{
		// ランダムな加速度を設定 ( ややY↑に偏った)
		D3DXVECTOR3 RandomVelocity{ CUtility::GetRandomValue<float>() * 0.01f, fabsf(CUtility::GetRandomValue<float>()) * 0.03f, -0.5f };

		// がれきを生成
		CRubble::Create(0,						// 通常
			GetPos() + RandomVelocity * 2.0f,	// 座標
			RandomVelocity * 0.5f);				// 加速度
	}
#endif
}

//============================================================================
// 初期設定
//============================================================================
HRESULT CBlock::Init()
{
	// 基底クラスの初期設定
	HRESULT hr = CObject_X::Init();

	if (FAILED(hr))
	{
		assert(false && "プレイヤークラスの初期設定に失敗");
	}

	return hr;
}

//============================================================================
// 終了処理
//============================================================================
void CBlock::Uninit()
{
	// 基底クラスの終了処理
	CObject_X::Uninit();
}

//============================================================================
// 更新処理
//============================================================================
void CBlock::Update()
{
	// すぐにけせ
	Vec3 NewRot = GetRot();
	NewRot.y += D3DX_PI * 0.001f;
	SetRot(NewRot);

	// 基底クラスの更新処理
	CObject_X::Update();

#if 0
#ifdef _DEBUG

	CRenderer::SetDebugString("＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝");
	CRenderer::SetDebugString("岩サイズ　 : " + to_string(GetSize().x) + " :  " + to_string(GetSize().y) + " : " + to_string(GetSize().z));
	CRenderer::SetDebugString("岩向き　　 : " + to_string(GetRot().x * (180 / D3DX_PI)) + " :  " + to_string(GetRot().y * (180 / D3DX_PI)) + " : " + to_string(GetRot().z * (180 / D3DX_PI)));
	CRenderer::SetDebugString("岩θ　　　　: " + to_string(GetRot().y));
	CRenderer::SetDebugString("岩座標　　 : " + to_string(GetPos().x) + " :  " + to_string(GetPos().y) + " : " + to_string(GetPos().z));
	CRenderer::SetDebugString("＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝");

#endif // _DEBUG
#endif
}

//============================================================================
// 描画処理
//============================================================================
void CBlock::Draw()
{
	// 基底クラスの描画処理
	CObject_X::Draw();
}

//============================================================================
// 生成
//============================================================================
CBlock* CBlock::Create()
{
	// インスタンスを生成
	CBlock* pNewInstance = DBG_NEW CBlock();

	// タイプを設定
	pNewInstance->SetType(TYPE::NONE);

	// 初期設定
	pNewInstance->Init();

	// モデルを設定
	pNewInstance->BindModel(CModel_X_Manager::TYPE::TEST);

	return pNewInstance;
}

//============================================================================
// 生成
//============================================================================
CBlock* CBlock::Create(const D3DXVECTOR3& Pos, const D3DXVECTOR3& Rot)
{
	// インスタンスを生成
	CBlock* pNewInstance = DBG_NEW CBlock();

	// タイプを設定
	pNewInstance->SetType(TYPE::BLOCK);

	// 初期設定
	pNewInstance->Init();

	// 座標を設定
	pNewInstance->SetPos(Pos);

	// 向きを設定
	pNewInstance->SetRot(Rot);

	// モデルを設定
	pNewInstance->BindModel(CModel_X_Manager::TYPE::TEST);

	// サイズを設定
	pNewInstance->SetSize(D3DXVECTOR3(10.0f, 10.0f, 10.0f));

	// 描画前に1度更新
	pNewInstance->Update();

	return pNewInstance;
}